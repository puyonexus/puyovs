#include "DropPattern.h"
#include "global.h"
#include <algorithm>
#include <string>
#include <vector>

using namespace std;

namespace ppvs {

// Make sure the order is the same as the order as the enum
DropSet dropPattern[] = {
	{ { DOUBLET, TRIPLET, DOUBLET, TRIPLET_R, DOUBLET, TRIPLET, DOUBLET, BIG, DOUBLET, TRIPLET_R, DOUBLET, TRIPLET, DOUBLET, TRIPLET_R, DOUBLET, QUADRUPLET } },
	{ { DOUBLET, DOUBLET, DOUBLET, TRIPLET, DOUBLET, DOUBLET, DOUBLET, BIG, DOUBLET, DOUBLET, DOUBLET, TRIPLET_R, DOUBLET, DOUBLET, DOUBLET, QUADRUPLET } },
	{ { DOUBLET, DOUBLET, DOUBLET, DOUBLET, DOUBLET, DOUBLET, DOUBLET, DOUBLET, DOUBLET, DOUBLET, DOUBLET, DOUBLET, DOUBLET, DOUBLET, DOUBLET, DOUBLET } },
	{ { DOUBLET, DOUBLET, DOUBLET, TRIPLET, DOUBLET, DOUBLET, DOUBLET, QUADRUPLET, DOUBLET, DOUBLET, DOUBLET, BIG, DOUBLET, DOUBLET, DOUBLET, QUADRUPLET } },
	{ { DOUBLET, DOUBLET, DOUBLET, DOUBLET, DOUBLET, DOUBLET, DOUBLET, DOUBLET, DOUBLET, DOUBLET, TRIPLET, TRIPLET_R, BIG, TRIPLET_R, TRIPLET, QUADRUPLET } },
	{ { DOUBLET, TRIPLET, BIG, DOUBLET, QUADRUPLET, TRIPLET_R, DOUBLET, DOUBLET, DOUBLET, TRIPLET, QUADRUPLET, DOUBLET, BIG, TRIPLET_R, DOUBLET, DOUBLET } },
	{ { DOUBLET, TRIPLET, TRIPLET_R, TRIPLET, DOUBLET, DOUBLET, TRIPLET, TRIPLET_R, TRIPLET, DOUBLET, QUADRUPLET, BIG, DOUBLET, DOUBLET, TRIPLET, DOUBLET } },
	{ { TRIPLET, DOUBLET, BIG, DOUBLET, TRIPLET_R, DOUBLET, QUADRUPLET, DOUBLET, BIG, DOUBLET, TRIPLET, DOUBLET, QUADRUPLET, DOUBLET, TRIPLET_R, DOUBLET } },
	{ { DOUBLET, DOUBLET, TRIPLET, DOUBLET, TRIPLET_R, DOUBLET, BIG, DOUBLET, TRIPLET, DOUBLET, BIG, DOUBLET, TRIPLET_R, DOUBLET, DOUBLET, QUADRUPLET } },
	{ { DOUBLET, TRIPLET, DOUBLET, BIG, DOUBLET, TRIPLET_R, DOUBLET, DOUBLET, DOUBLET, TRIPLET, DOUBLET, QUADRUPLET, DOUBLET, BIG, DOUBLET, TRIPLET_R } },
	{ { DOUBLET, DOUBLET, TRIPLET, DOUBLET, DOUBLET, TRIPLET_R, DOUBLET, DOUBLET, QUADRUPLET, DOUBLET, DOUBLET, BIG, DOUBLET, DOUBLET, DOUBLET, QUADRUPLET } },
	{ { DOUBLET, DOUBLET, DOUBLET, TRIPLET, DOUBLET, DOUBLET, TRIPLET_R, BIG, DOUBLET, DOUBLET, TRIPLET, BIG, DOUBLET, DOUBLET, TRIPLET_R, QUADRUPLET } },
	{ { DOUBLET, DOUBLET, DOUBLET, DOUBLET, TRIPLET, DOUBLET, DOUBLET, DOUBLET, DOUBLET, BIG, DOUBLET, DOUBLET, DOUBLET, DOUBLET, DOUBLET, QUADRUPLET } },
	{ { DOUBLET, DOUBLET, TRIPLET, DOUBLET, DOUBLET, BIG, DOUBLET, DOUBLET, DOUBLET, TRIPLET_R, DOUBLET, DOUBLET, TRIPLET, DOUBLET, DOUBLET, QUADRUPLET } },
	{ { DOUBLET, DOUBLET, DOUBLET, TRIPLET, DOUBLET, DOUBLET, BIG, DOUBLET, DOUBLET, TRIPLET_R, DOUBLET, DOUBLET, BIG, DOUBLET, DOUBLET, QUADRUPLET } },
	{ { DOUBLET, TRIPLET_R, DOUBLET, DOUBLET, DOUBLET, DOUBLET, BIG, DOUBLET, DOUBLET, DOUBLET, DOUBLET, QUADRUPLET, DOUBLET, DOUBLET, TRIPLET, DOUBLET } },
	{ { DOUBLET, DOUBLET, DOUBLET, TRIPLET, BIG, DOUBLET, DOUBLET, DOUBLET, TRIPLET_R, BIG, QUADRUPLET, DOUBLET, DOUBLET, TRIPLET, DOUBLET, TRIPLET } },
	{ { DOUBLET, DOUBLET, DOUBLET, QUADRUPLET, DOUBLET, DOUBLET, DOUBLET, BIG, DOUBLET, DOUBLET, DOUBLET, QUADRUPLET, DOUBLET, DOUBLET, DOUBLET, BIG } },
	{ { DOUBLET, DOUBLET, DOUBLET, TRIPLET, DOUBLET, DOUBLET, DOUBLET, BIG, DOUBLET, DOUBLET, DOUBLET, QUADRUPLET, DOUBLET, DOUBLET, DOUBLET, BIG } },
	{ { DOUBLET, DOUBLET, DOUBLET, DOUBLET, TRIPLET, DOUBLET, QUADRUPLET, DOUBLET, TRIPLET_R, DOUBLET, BIG, DOUBLET, TRIPLET, DOUBLET, QUADRUPLET, DOUBLET } },
	{ { DOUBLET, DOUBLET, DOUBLET, TRIPLET, DOUBLET, DOUBLET, DOUBLET, QUADRUPLET, DOUBLET, DOUBLET, TRIPLET_R, DOUBLET, BIG, DOUBLET, DOUBLET, QUADRUPLET } },
	{ { DOUBLET, DOUBLET, TRIPLET, DOUBLET, DOUBLET, TRIPLET_R, DOUBLET, BIG, DOUBLET, TRIPLET, DOUBLET, DOUBLET, TRIPLET_R, DOUBLET, DOUBLET, BIG } },
	{ { TRIPLET_R, TRIPLET, DOUBLET, DOUBLET, TRIPLET_R, DOUBLET, DOUBLET, DOUBLET, QUADRUPLET, DOUBLET, DOUBLET, DOUBLET, BIG, DOUBLET, DOUBLET, DOUBLET } },
	{ { DOUBLET, TRIPLET, DOUBLET, BIG, DOUBLET, TRIPLET_R, DOUBLET, BIG, DOUBLET, TRIPLET, DOUBLET, QUADRUPLET, DOUBLET, DOUBLET, DOUBLET, QUADRUPLET } }
};

MovePuyoType getFromDropPattern(const PuyoCharacter p, int i)
{
	i %= 16;
	return dropPattern[static_cast<unsigned char>(p)].mpt[i];
}

int nuisanceDropPattern(const int maxX, int cycle)
{
	const auto pattern = new int[maxX];
	createNuisancePattern(maxX, pattern);

	// Cycle val cannot be larger than  max
	cycle %= maxX;

	// Cycle through pattern
	int returnVal = pattern[cycle] + cycle / maxX;
	returnVal %= maxX;

	delete[] pattern;
	return returnVal;
}

// Generates pattern, puts in array, so that it will work for every width of puyo field
void createNuisancePattern(int max, int* array)
{
	const bool even = (max % 2 == 0);
	if (!even) {
		max++;
	}
	const int divider = max / 2;
	int remember = 0;
	for (int i = 0; i < max; i++) {
		const int x = i / divider;
		const int y = ((-i + divider * 100) % divider);
		const int z = x + y * 2;
		if (!even && z >= max - 1) {
			// Do not use out of bound value in uneven situation
			remember = i;
			continue;
		}
		if (!even && i == max - 1) {
			array[z] = remember;
		} else {
			array[z] = i;
		}
	}
}

// Fever chains are stored in a 3D array of strings ->  feverChains[type][colors][chain number]
std::string feverChains[12][3][13];

void initFeverChains()
{
	// Type: Stairs (0)
	// ------Colors: 3
	feverChains[0][0][0] = "2320001230001230001230";
	feverChains[0][0][1] = "32320013230013230013230";
	feverChains[0][0][2] = "120012310021230021231121231";
	feverChains[0][0][3] = "30212012322021231021231021231";
	feverChains[0][0][4] = "200000300000200000230000212310321231321231321231";
	feverChains[0][0][5] = "200000300000200000230212212322321231321231321231";
	feverChains[0][0][6] = "200000320000230001233212212322321231321231321231";
	feverChains[0][0][7] = "200000300000230000230000311330231212212322321231321231321231";
	feverChains[0][0][8] = "200000300000231000231001313331231212212322321231321231321231";
	feverChains[0][0][9] = "200003300001231003231011313331231212212322321231321231321231";
	feverChains[0][0][10] = "1200003300021231022231011313331231212212322321231321231321231";
	feverChains[0][0][11] = "1000003200001300321231332231221313331231212212321321231321231321232";
	feverChains[0][0][12] = "20300033200131312221231332231221313331231212212322321231321231321231";
	// ------Colors: 4
	feverChains[0][1][0] = "2320001230001230001230";
	feverChains[0][1][1] = "1300032420013240013240013240";
	feverChains[0][1][2] = "2140014310021430021431121431";
	feverChains[0][1][3] = "30212014322021431021431021431";
	feverChains[0][1][4] = "200000300000200000230000214340321434321434321434";
	feverChains[0][1][5] = "200000300000200000230414242344324231324231324231";
	feverChains[0][1][6] = "200000400000340000430000433212412322341231341231341231";
	feverChains[0][1][7] = "400000300000430000430000311330431242412322341234341234341234";
	feverChains[0][1][8] = "400000300000431000431004313334431242412322341234341234341234";
	feverChains[0][1][9] = "300003400001321003221011313331321414312344431231431231431231";
	feverChains[0][1][10] = "1400003300024431022431044313334431242412322341234341234341234";
	feverChains[0][1][11] = "1000003200001400321241332211221443331241242212324421234421234421232";
	feverChains[0][1][12] = "20400033200131312221241332241221413331241242214322321434321434321434";
	// ------Colors: 5
	feverChains[0][2][0] = "2320001230001230001230";
	feverChains[0][2][1] = "1300032420013240013240013240";
	feverChains[0][2][2] = "2340014550021430021435121435";
	feverChains[0][2][3] = "30515014355021431021431021431";
	feverChains[0][2][4] = "200000300000200000230000215340321534321534321534";
	feverChains[0][2][5] = "200000300000200000230414245344324531324531324531";
	feverChains[0][2][6] = "200000400000340000430000433212452522345251345251345251";
	feverChains[0][2][7] = "400000300000450000450000511330451545412355341234341234341234";
	feverChains[0][2][8] = "400000300000451000551004413334451545412355341234341234341234";
	feverChains[0][2][9] = "200003400001254003554011243331254515212355421231421231421231";
	feverChains[0][2][10] = "1400003300025451022551055413335451242412522341254341254341254";
	feverChains[0][2][11] = "1000005500001400321541332511221445551541242512324451234451234451232";
	feverChains[0][2][12] = "50400033200131515551241335241551413331241242214322521434521434521434";

	// Type: Key (1)
	// ------Colors: 3
	feverChains[1][0][0] = "200000300003100003300022100023110";
	feverChains[1][0][1] = "1000003210003310011220013211";
	feverChains[1][0][2] = "2000002000003003213003311011223013213";
	feverChains[1][0][3] = "2000002000003013213013311221223213213";
	feverChains[1][0][4] = "300000200000200002200002300003313213313311221223213213";
	feverChains[1][0][5] = "200000300000220000321203313213313311221223213213";
	feverChains[1][0][6] = "220000320000211300321203313213313311221223213213";
	feverChains[1][0][7] = "221000321002213302321323313213313311221223213213";
	feverChains[1][0][8] = "221300323301211221321323313213313311221223213213";
	feverChains[1][0][9] = "1221302323311211221321323313213313311221223213213";
	feverChains[1][0][10] = "1000002000021221322323311211221321323313213313311221223213213";
	feverChains[1][0][11] = "2000021000012310011221322323311211221321323313213313311221223213213";
	feverChains[1][0][12] = "22000031001113332233221322323311311221221323313213313311221223213213";
	// ------Colors: 4
	feverChains[1][1][0] = "200000300003100003300022100023110";
	feverChains[1][1][1] = "1000003240003340011220013244";
	feverChains[1][1][2] = "2000002000001003421003322011441013421";
	feverChains[1][1][3] = "4000003000002013412013311221442213412";
	feverChains[1][1][4] = "300000200000200002200002300003341243341144224223241243";
	feverChains[1][1][5] = "200000400000220000421302414312414411221332214312";
	feverChains[1][1][6] = "220000320000211400321204343214343311224224243214";
	feverChains[1][1][7] = "221000421004213304421343413413413311221443213413";
	feverChains[1][1][8] = "441300343301411221341323313243313344441223413243";
	feverChains[1][1][9] = "1441302343311411221341323313243313344441223413243";
	feverChains[1][1][10] = "1000004000021441322343311411441341343314213314411441223414213";
	feverChains[1][1][11] = "2000021000012300011442322322311443221342323313243311344443223413243";
	feverChains[1][1][12] = "22000034001113332233441322343344311224441323313213313311441223413213";
	// ------Colors: 5
	feverChains[1][2][0] = "200000300003100003300022100023110";
	feverChains[1][2][1] = "1000003240003340011220013244";
	feverChains[1][2][2] = "4000002000002000005003425003325011442013425";
	feverChains[1][2][3] = "2000002000001015431015533221441215431";
	feverChains[1][2][4] = "300000200000200002200002300003345213345511224223245213";
	feverChains[1][2][5] = "500000400003550003451302414312414411551332514312";
	feverChains[1][2][6] = "550000150002511402151204143254143355554224543254";
	feverChains[1][2][7] = "221000411004223304421345453415453311225445253415";
	feverChains[1][2][8] = "441300543301411221541323513253513355441223413253";
	feverChains[1][2][9] = "1441302343311411221341325315245315544441225415245";
	feverChains[1][2][10] = "1000004000021551322353311511441351343314253314455551223514253";
	feverChains[1][2][11] = "2000021000012300011442322522311443221542323513543511344443553413543";
	feverChains[1][2][12] = "22000034301113102233441522545544511224441523513253513355441223413253";

	// Type: Stairwich (2)
	// ------Colors: 3
	feverChains[2][0][0] = "2000002000001000001000122003311003122";
	feverChains[2][0][1] = "13122222311333122";
	feverChains[2][0][2] = "100000200000200001200001113122122311233122";
	feverChains[2][0][3] = "200000130000332000113122122311233122";
	feverChains[2][0][4] = "200000130000322000332300113122122311233122";
	feverChains[2][0][5] = "210000332000223300332310113122122311233122";
	feverChains[2][0][6] = "120000120000332230223311332231113122122311233122";
	feverChains[2][0][7] = "2120001120001332322223112332331113122122311233122";
	feverChains[2][0][8] = "1200002102003321033312322223112332331113122122311233122";
	feverChains[2][0][9] = "21000033120022120233332322223112332331113122122311233122";
	feverChains[2][0][10] = "21000233021122121233332322223112332331113122122311233122";
	feverChains[2][0][11] = "13021011233123322123233332322223112332331113122122311233122";
	feverChains[2][0][12] = "200031130032210221113233222322113233332322223112332331113122122311233122";
	// ------Colors: 4
	feverChains[2][1][0] = "2000002000001000001000122003311003122";
	feverChains[2][1][1] = "13144222311333144";
	feverChains[2][1][2] = "100000200000200004200004113411122344233411";
	feverChains[2][1][3] = "400000130000334000113244144322433244";
	feverChains[2][1][4] = "400000130000322000332300113411144344433411";
	feverChains[2][1][5] = "210000442000223300442340113422122344233422";
	feverChains[2][1][6] = "140000140000224430443311224431113122144311433122";
	feverChains[2][1][7] = "2140001140001334322443112334331113422144344433422";
	feverChains[2][1][8] = "1200004102003321033314344443114334331113144122311233144";
	feverChains[2][1][9] = "21000044140011140144224322443112224331113122144311433122";
	feverChains[2][1][10] = "41000433021144121433332344223114332331114122122411244122";
	feverChains[2][1][11] = "13041011433123344123433442344223114442331113422122344233422";
	feverChains[2][1][12] = "200031430034210221113233222322443233332322223112332331443144422311233144";
	// ------Colors: 5
	feverChains[2][2][0] = "2000002000001000001000122003311003122";
	feverChains[2][2][1] = "13144222311333144";
	feverChains[2][2][2] = "100000200000200004200054113455122344233455";
	feverChains[2][2][3] = "500000130000335000112455155244522455";
	feverChains[2][2][4] = "400000130000322000332300115455144544455455";
	feverChains[2][2][5] = "510000442000223300442340113455155344533455";
	feverChains[2][2][6] = "540000540000224430443311224431553122544311433122";
	feverChains[2][2][7] = "2140001140001554322443112554331113522144355433522";
	feverChains[2][2][8] = "1200002102003521033514322443112554331113544122355233544";
	feverChains[2][2][9] = "21000044140055140544225322553112225331113522144355433522";
	feverChains[2][2][10] = "41000455021144521455332344223114332331554155522411244155";
	feverChains[2][2][11] = "13041011455123344123455552344223114552331113455122344233455";
	feverChains[2][2][12] = "500051430054210221113255222322443255332522225112332551443144455311533144";

	// Type: Avalanche (3)
	// ------Colors: 3
	feverChains[3][0][0] = "200000300000111000333210222110";
	feverChains[3][0][1] = "200000100000300000200000333000222000333120111220";
	feverChains[3][0][2] = "300000100000300000200000300000111000333000222000333120111220";
	feverChains[3][0][3] = "100000300000200000300000100000200000333000222000111000333000222310333110";
	feverChains[3][0][4] = "300000200000200000300000100000200000333000222000111000333030221310333110";
	feverChains[3][0][5] = "300000200000200000300000100000200000333000222000111001333021221212333112";
	feverChains[3][0][6] = "300000200000200000300000100000200000333001222001111022333232221313333113";
	feverChains[3][0][7] = "300000200000200000300000100001200001333002222022111211333131221313333113";
	feverChains[3][0][8] = "300000200000200000300002100003200023333032222322111211333131221313333113";
	feverChains[3][0][9] = "300000200000200000300000103003201123333132222322111211333131221313333113";
	feverChains[3][0][10] = "300000200000200000300002131103212223333132222322111211333131221313333113";
	feverChains[3][0][11] = "300000200000200321300332130123211223333132222322111211333131221313333113";
	feverChains[3][0][12] = "100022300011200033210311330123211223333132222322111211333131221313333113";
	// ------Colors: 4
	feverChains[3][1][0] = "200000300000111000333210222110";
	feverChains[3][1][1] = "400000100000300000200000333000222000333140111440";
	feverChains[3][1][2] = "400000100000300000200000400000111000444000222000333140111440";
	feverChains[3][1][3] = "400000300000200000400000100000200000333000222000111000444000222340333440";
	feverChains[3][1][4] = "400000200000200000300000400000200000333000222000444000333030221310444110";
	feverChains[3][1][5] = "300000400000400000300000100000200000444000222000111001333041441414333114";
	feverChains[3][1][6] = "400000200000200000300000400000200000333001222004444011333141221414444114";
	feverChains[3][1][7] = "400000200000200000300001200004400001111003444033222311333141221414444114";
	feverChains[3][1][8] = "400000200000200001400004100023200021333011222122111233444343221414444114";
	feverChains[3][1][9] = "400000200000200000300000103003401123333132444322111211333141221414444114";
	feverChains[3][1][10] = "400000200000200000300002131104212224333142222422111211333141221414444114";
	feverChains[3][1][11] = "400000200000200341300334430143211443333132222322444211333141221414444114";
	feverChains[3][1][12] = "100022400011240033210311330123211223333134222344111411333141221414444114";
	// ------Colors: 5
	feverChains[3][2][0] = "200000400000111400444230222330";
	feverChains[3][2][1] = "400000100000500000200000333000222500555140111440";
	feverChains[3][2][2] = "500000400000300000200000500000111000555000222300333450444550";
	feverChains[3][2][3] = "500000300000500000400000100000200000333000222000111000444500555350333550";
	feverChains[3][2][4] = "500000200000200000300000400000200000333000222000444000333050221510555115";
	feverChains[3][2][5] = "500000400000400000300000500000200000444000222000555001333041441414555114";
	feverChains[3][2][6] = "500000200000200000300000400000200000333001222005444011333151221515555115";
	feverChains[3][2][7] = "500000200000200000300001200005400001111003444033222311333151221515555115";
	feverChains[3][2][8] = "400000500000500001400004100023200025333055222522111233444343551414444114";
	feverChains[3][2][9] = "400001200004200001300002503055401125333152444522555211333141221414444114";
	feverChains[3][2][10] = "400005100004100002401004135503215103333134222344111422444242115454444554";
	feverChains[3][2][11] = "500000200000200341300334430145211445333152222522444211333151221515555115";
	feverChains[3][2][12] = "100022400011240033210311550123211223555135222355111522555242221414444114";

	// 15th Anniversary
	// Type: Stairs (4)
	// ------Colors: 3
	feverChains[4][0][0] = "2320001230001230001230";
	feverChains[4][0][1] = "2100023230012310012310012310";
	feverChains[4][0][2] = "310031210013120013121013121";
	feverChains[4][0][3] = "200000100000200000100000100000132320213230213230213230";
	feverChains[4][0][4] = "20000210000310000210000233300212120323210323210323210";
	feverChains[4][0][5] = "300000100300210100133100123100131210212120212120212120";
	feverChains[4][0][6] = "300000203000323000231000231120212320321230321232321232";
	feverChains[4][0][7] = "202000102300213100123100123100131230213123213123213123";
	feverChains[4][0][8] = "200300200103200312110133130132310123210312313312321312323";
	feverChains[4][0][9] = "200000100000212131212311121133212121231312123132123132123131";
	feverChains[4][0][10] = "200003100001213231232331113212213232232132123213123213123212";
	feverChains[4][0][11] = "2000001300012100011312322122112313313312323323123132312132312132313";
	feverChains[4][0][12] = "10300032100113300133132322332323123111132323123123312312312312312313";
	// ------Colors: 4
	feverChains[4][1][0] = "2320001230001230001230";
	feverChains[4][1][1] = "2400023230012340012340012340";
	feverChains[4][1][2] = "1340034240013420013424013424";
	feverChains[4][1][3] = "200000100000200000100000121000134340213430213430213430";
	feverChains[4][1][4] = "440000310000410000410000423230342320342320342320";
	feverChains[4][1][5] = "112000421000121000121000134340413430413430413430";
	feverChains[4][1][6] = "300000203000423000231000231140214340421430421434421434";
	feverChains[4][1][7] = "300000232300423100323100323140314240421420421424421424";
	feverChains[4][1][8] = "300000121400314110214130214240243243314343314324314323";
	feverChains[4][1][9] = "300000200000342140322411441141342143314323231432231432231432";
	feverChains[4][1][10] = "200002100001213421233221114414213434234134123413123413123414";
	feverChains[4][1][11] = "21400014100012412312122442413343412323423123142312142312142313";
	feverChains[4][1][12] = "3400024100122300114142424442334124431142421124321312432312432312431";
	// ------Colors: 5
	feverChains[4][2][0] = "2320001230001230001230";
	feverChains[4][2][1] = "2400023230012340012340012340";
	feverChains[4][2][2] = "1340034240013420013424013424";
	feverChains[4][2][3] = "200000500000200000100000125000134340253430253430253430";
	feverChains[4][2][4] = "440000310000410000414000425250342520342520342520";
	feverChains[4][2][5] = "112000421000121000121000135350413530413530413530";
	feverChains[4][2][6] = "300000203000453000531000531140514540421450421454421454";
	feverChains[4][2][7] = "300000232300423100323100323150315250421520421525421525";
	feverChains[4][2][8] = "500000121400514110214130214250243253514353514325514323";
	feverChains[4][2][9] = "300000200000352140322411551141352143314523231452231452231452";
	feverChains[4][2][10] = "200002100001213421233221114415213435254135125413125413125415";
	feverChains[4][2][11] = "21500014100012512312122442513345512325543125154312154312154315";
	feverChains[4][2][12] = "3400024100122500114142524442334125535142525124325512432512432512435";

	// Type: Key (5)
	// ------Colors: 3
	feverChains[5][0][0] = "230000220001131001233";
	feverChains[5][0][1] = "3210003310011221013213";
	feverChains[5][0][2] = "230002313002213011331012313";
	feverChains[5][0][3] = "30000031032123033122112213132121";
	feverChains[5][0][4] = "300000100000100030123123323313332122123123";
	feverChains[5][0][5] = "100000300000100000110000330003323123113322122113323123";
	feverChains[5][0][6] = "300000230000330000211000231002213212331221313312213212";
	feverChains[5][0][7] = "200000123000233000121100123101131231223233231121131231";
	feverChains[5][0][8] = "200000121300123300211220121323132133232122223212132123";
	feverChains[5][0][9] = "200200321110323230232211323313312123221212212123312121";
	feverChains[5][0][10] = "2000001300001132121121223332132132132121312332311321132121313";
	feverChains[5][0][11] = "32000111000333113212313122132211313232321323312132121323121323";
	feverChains[5][0][12] = "3000322001133201322323213132133223211123232131312121331332121321321";
	// ------Colors: 4
	feverChains[5][1][0] = "230000220001131001233";
	feverChains[5][1][1] = "4230004430011223014231";
	feverChains[5][1][2] = "240002314002214011331012314";
	feverChains[5][1][3] = "10000014042321044322112231142324";
	feverChains[5][1][4] = "400000100000100030123423422343443422323423";
	feverChains[5][1][5] = "100000400000100000110000440002423412113311122442323412";
	feverChains[5][1][6] = "200000430000330000411000431004414234221223214434314234";
	feverChains[5][1][7] = "400000123000233000121100123103131423443422431143131423";
	feverChains[5][1][8] = "100000321300323300211220321324343234144233113324243234";
	feverChains[5][1][9] = "400030320011224312343342324424312314441231412314312312";
	feverChains[5][1][10] = "3000001200001134131144332331142134124141234224233241124141232";
	feverChains[5][1][11] = "40000012000011000444142312322322443111342324323142312314123142123142";
	feverChains[5][1][12] = "4000233001122301233142314443144122311142342123142332114323324123132";
	// ------Colors: 5
	feverChains[5][2][0] = "230000220001131001233";
	feverChains[5][2][1] = "4230004430011223014235";
	feverChains[5][2][2] = "240002354002254011335012354";
	feverChains[5][2][3] = "10000014042351044355112231142354";
	feverChains[5][2][4] = "400000100000100050153425455345443422353425";
	feverChains[5][2][5] = "100000500000100000110000550005523415113311122445323415";
	feverChains[5][2][6] = "200000530000330000511000531004514254221225214454314254";
	feverChains[5][2][7] = "400000523000233000521100523102531452443455431142131452";
	feverChains[5][2][8] = "100000521300523300211220521324543534144533113354243534";
	feverChains[5][2][9] = "400030520011224315543345524454512314441231412314312315";
	feverChains[5][2][10] = "5000001200001134151144552331142134124145234224233245524145232";
	feverChains[5][2][11] = "40000015000011000444142315522355443111542324523542512354123542123542";
	feverChains[5][2][12] = "4000255001122301255142314443144122311142352153452335445353325153432";
	// Type: Stairwich (6)
	// ------Colors: 3
	feverChains[6][0][0] = "12000312001133001322";
	feverChains[6][0][1] = "2330013210011321033211";
	feverChains[6][0][2] = "300302112132133211322122";
	feverChains[6][0][3] = "200000300000300002110003313123322311233133";
	feverChains[6][0][4] = "20000120000311000221230332132311211122133";
	feverChains[6][0][5] = "110200322112111213332123311211122133";
	feverChains[6][0][6] = "3000001132131311331222122313211311322233211";
	feverChains[6][0][7] = "10000030000111113233322131111212323132332311223122";
	feverChains[6][0][8] = "302211133132312121122332213131322122133211322";
	feverChains[6][0][9] = "3000003203011322313112131213122133333212112322333233122321";
	feverChains[6][0][10] = "200000113202122301233222311311223221111332223211111322233211";
	feverChains[6][0][11] = "200012113133122311233133311311223221111332223211111322233211";
	feverChains[6][0][12] = "310000113031323122332311223122111233332113111221332133211211322133";
	// ------Colors: 4
	feverChains[6][1][0] = "12000312001133001322";
	feverChains[6][1][1] = "401013241011322033211";
	feverChains[6][1][2] = "300304112134133211322144";
	feverChains[6][1][3] = "30001411102332312344233422322";
	feverChains[6][1][4] = "140000311100444340332143311211122144";
	feverChains[6][1][5] = "210400344113111412334132322411244122";
	feverChains[6][1][6] = "3000011004131121332444113223423211344133433";
	feverChains[6][1][7] = "34000111414244322343111232332142344211422122";
	feverChains[6][1][8] = "200000402411144123412131122223313121423144144411433";
	feverChains[6][1][9] = "4000311314414433134243122144333212112312444233322322";
	feverChains[6][1][10] = "200000113200122314233222141311243441111334443411222344133411";
	feverChains[6][1][11] = "400012112133144211422133233411114221333442114311222433344311";
	feverChains[6][1][12] = "410000114031434322443433334322122433334113222441334122111411244122";
	// ------Colors: 5
	feverChains[6][2][0] = "12000312001133001322";
	feverChains[6][2][1] = "405013245011322033255";
	feverChains[6][2][2] = "300304112534133255322544";
	feverChains[6][2][3] = "30001411103332513344255422533";
	feverChains[6][2][4] = "140000311100444340332543311255122544";
	feverChains[6][2][5] = "250400344113555415334135322411244155";
	feverChains[6][2][6] = "3000011004131151332444115553425511344133455";
	feverChains[6][2][7] = "35000111414255522353111235552145544211422155";
	feverChains[6][2][8] = "200000402411144523412531122223313521523544155411533";
	feverChains[6][2][9] = "4000311513414455154235122133555212112312444233322322";
	feverChains[6][2][10] = "200000115200122515255222141311543551111335443411555344133411";
	feverChains[6][2][11] = "400052112533144255422533255455114225555442114311222433544311";
	feverChains[6][2][12] = "410000114035454322445433554322122433334553222445335122111511255122";
	// Type: Turukame & Stairs Mix (7)
	// ------Colors: 3
	feverChains[7][0][0] = "2300003201001231011231";
	feverChains[7][0][1] = "33200031200012100013100013120";
	feverChains[7][0][2] = "10002210032310013130013230013232";
	feverChains[7][0][3] = "202000201023231012313012313012323";
	feverChains[7][0][4] = "2000002000001000031002232023232012323012312012321";
	feverChains[7][0][5] = "1000001100002200002100002102233131212213131213121213131";
	feverChains[7][0][6] = "100000200023100323100323132131213232213211213231";
	feverChains[7][0][7] = "1300001100002200012100123120313131313212131212131212123";
	feverChains[7][0][8] = "1020001210013310013210032232312211312323231323232323213";
	feverChains[7][0][9] = "2300002303003203021321032231032231032212321321231321231321232";
	feverChains[7][0][10] = "2000003000003300011203131323223231121231232212123321213321213321212";
	feverChains[7][0][11] = "2000023000111300222100133313123131221133131121213312123312123312121";
	feverChains[7][0][12] = "31002113003133203211131323231232231233122212312321213321212321231";
	// ------Colors: 4
	feverChains[7][1][0] = "2300003204001234011234";
	feverChains[7][1][1] = "33400032400014200013200013240";
	feverChains[7][1][2] = "40002140032340013430013230013231";
	feverChains[7][1][3] = "204000214043234014313014343014323";
	feverChains[7][1][4] = "4000004000001000031004432023432012323012312012341";
	feverChains[7][1][5] = "1000001200002400002100403100423132412423231423241423231";
	feverChains[7][1][6] = "300003400023100023102421121241432142432141432131";
	feverChains[7][1][7] = "3000003300003100031200021100021120024134314212432212434212434";
	feverChains[7][1][8] = "3000003000003100041300041400041100423140123132123414212414213414231";
	feverChains[7][1][9] = "4000004400004400002334002241042341031341031312421231243231243231241";
	feverChains[7][1][10] = "20330012443412234214434234434234412123241213241214241212";
	feverChains[7][1][11] = "4000024000013440011114343343243143213143212121422312141312141312142";
	feverChains[7][1][12] = "4000401401144401421242311323223423213423431414241321421321423321424";
	// ------Colors: 5
	feverChains[7][2][0] = "2300003204001234011234";
	feverChains[7][2][1] = "33400032400014200013200013240";
	feverChains[7][2][2] = "40002540032340013430013230013235";
	feverChains[7][2][3] = "204000214053254015315015345015325";
	feverChains[7][2][4] = "4000004000001000051004453025453012535012513012541";
	feverChains[7][2][5] = "1000001500002400002100403100423135412453531453541453531";
	feverChains[7][2][6] = "300003400053100053105451152541435245435241435231";
	feverChains[7][2][7] = "5000005300005100051200021100021120024135314212532212534212534";
	feverChains[7][2][8] = "3000003000003100045500045400045100423140523152523414252414253414235";
	feverChains[7][2][9] = "4000004400004400002554002241042541031541031512521251253251253251251";
	feverChains[7][2][10] = "50330015443415234514434534434534412153241213241214241215";
	feverChains[7][2][11] = "1000024000013550011115343353243153243153251121415312145312145312141";
	feverChains[7][2][12] = "4000401501144501421245311353223453253453435414245321425321423321424";
	// Type: Key & Stairs Mix (8)
	// ------Colors: 3
	feverChains[8][0][0] = "3100003310011210013210";
	feverChains[8][0][1] = "300030210010210013321013231";
	feverChains[8][0][2] = "301032101031201013233113231";
	feverChains[8][0][3] = "2123132113132322313321323";
	feverChains[8][0][4] = "1000001000002000112023132121313112323332313";
	feverChains[8][0][5] = "200000310000110000320102313132313123221313212323";
	feverChains[8][0][6] = "300000200011110012210132233132213213331312311231";
	feverChains[8][0][7] = "200000300000203100331132223212212312321331321223321212";
	feverChains[8][0][8] = "100000313000123000331100222102133202123213312123312321312133";
	feverChains[8][0][9] = "20100010100010200310120223133212222312131231132121223132232123";
	feverChains[8][0][10] = "121000112112322323111312323112313321231322121113121123123";
	feverChains[8][0][11] = "1000032000032001113113232212112133231213232232123213213313212213212";
	feverChains[8][0][12] = "30100013312113211221232312322321233221321312321321232221232331211";
	// ------Colors: 4
	feverChains[8][1][0] = "3200003320011420013420";
	feverChains[8][1][1] = "100030240010240013324013214";
	feverChains[8][1][2] = "403032103031203013244113243";
	feverChains[8][1][3] = "30102024132023432112413121423";
	feverChains[8][1][4] = "4000004000003000143024124122432113412321432";
	feverChains[8][1][5] = "200000300000110002310402341412341341224141243121";
	feverChains[8][1][6] = "300000200012110022210241241241241324334121314342";
	feverChains[8][1][7] = "200000300000204100441132224312212412321441321224321212";
	feverChains[8][1][8] = "200000323000243000331100444130231320213411323241323142321241";
	feverChains[8][1][9] = "40000010000013200313120442133421222341134141133414221424231412";
	feverChains[8][1][10] = "20000014000012112312323342312443112323324132322412113412123413";
	feverChains[8][1][11] = "3000042000112000144114242212332244234114214232341233231114231134234";
	feverChains[8][1][12] = "2140011212012214221314311224323342221341313241341314221322241321";
	// ------Colors: 5
	feverChains[8][2][0] = "3200003320011420013420";
	feverChains[8][2][1] = "500030240010240013324013254";
	feverChains[8][2][2] = "405032105031205013244113245";
	feverChains[8][2][3] = "50102024152025452112415121425";
	feverChains[8][2][4] = "4000004000003000143025124122532113512321532";
	feverChains[8][2][5] = "200000300000110002310402351452351345225145253125";
	feverChains[8][2][6] = "300000200053110033210145245145245214334515354243";
	feverChains[8][2][7] = "500000300000504100441132554352512452351445351224351252";
	feverChains[8][2][8] = "200000325000245000551100444130231350213411323541323145321541";
	feverChains[8][2][9] = "40000010000013200513120442155421222541135141133514221524231512";
	feverChains[8][2][10] = "20000014000012552312323342352443552353324135322415553415523413";
	feverChains[8][2][11] = "3000042000112000144554242252332244235554215232351233231554231534235";
	feverChains[8][2][12] = "2140011215012214221314311554323345221341353541345314225355245351";
	// Type: Folding (9)
	// ------Colors: 3
	feverChains[9][0][0] = "310000110000320000330000120000220000";
	feverChains[9][0][1] = "310000110000320000330000120000220000130000113000";
	feverChains[9][0][2] = "210000110000230000220000130000330000120230112230";
	feverChains[9][0][3] = "210000110000230000220000130200330320123230112230";
	feverChains[9][0][4] = "210000110000230000220000130330330132121213112212";
	feverChains[9][0][5] = "210000110000230000220323130323330123121212112213";
	feverChains[9][0][6] = "100000200000110000210000220000130020110020230113331313213132221132";
	feverChains[9][0][7] = "200000300000110000310003330003210031220331310221110323323232332231";
	feverChains[9][0][8] = "300000200000110001210023220031310032330023210323113231232321223321";
	feverChains[9][0][9] = "100020300010110010310022330033120132110311320331223212312121331123";
	feverChains[9][0][10] = "200000300023110033310012330023210021220012312032113221323133331312222313";
	feverChains[9][0][11] = "100023300013110032310021330013120012110221320231223112313233332321111323";
	feverChains[9][0][12] = "100013200032110121210313220231130121110313230232332121212313223232111231";
	// ------Colors: 4
	feverChains[9][1][0] = "310000110000320000330000420000220000";
	feverChains[9][1][1] = "410000110000420000440000320000220000340000334000";
	feverChains[9][1][2] = "210000110000230000220000430000330000420210442210";
	feverChains[9][1][3] = "210000110000240000220000340300440230312120331120";
	feverChains[9][1][4] = "210000110000230000220000430220330324413132441134";
	feverChains[9][1][5] = "210000110000230000220324430324330124421212442214";
	feverChains[9][1][6] = "400000200000110000210000220000430020440020230443334343213132221132";
	feverChains[9][1][7] = "400000300000110000310000330024420024440033120113221412134342113343";
	feverChains[9][1][8] = "300000200003110003210042220042340011330021240334443434214141221142";
	feverChains[9][1][9] = "100000400010110024410024440131120431110343320332223142341414334413";
	feverChains[9][1][10] = "200000400021110031410012440043230041220014130434332421142313113232444231";
	feverChains[9][1][11] = "200011400022110034410024440013230012220421430131332142412323443234111232";
	feverChains[9][1][12] = "400034200011110422210323220132430412440343130231334124124313113432222431";
	// ------Colors: 5
	feverChains[9][2][0] = "310000110000320000330000420000220000";
	feverChains[9][2][1] = "410000110000420000440000320000220000350000335000";
	feverChains[9][2][2] = "210000110000230000220000430000330000450520445520";
	feverChains[9][2][3] = "210000110000240000220000340500440250352520335520";
	feverChains[9][2][4] = "510000110000530000550000430220330524415152441154";
	feverChains[9][2][5] = "210000110000230000220325430325330125451512445515";
	feverChains[9][2][6] = "400000500000110000510000550000430020440020230443334543215152221152";
	feverChains[9][2][7] = "500000300000110000310000330024520024550033120113221412154542115543";
	feverChains[9][2][8] = "300000500003110003510042550042340055330025240334443434214145221142";
	feverChains[9][2][9] = "100000400010110024410024440151120451110345520332223142541414554415";
	feverChains[9][2][10] = "200000400025110035410012440043230041220014130434332421152353113232555235";
	feverChains[9][2][11] = "200011500022110034510024550053230052220425430135332142412523445254111252";
	feverChains[9][2][12] = "400012200043110512210313220231430421440343530532334154524313553435222431";
	// Type: Submarine (10)
	// ------Colors: 3
	feverChains[10][0][0] = "31000031000023000022000011000123";
	feverChains[10][0][1] = "10000020000021000123000112000233000113";
	feverChains[10][0][2] = "23000023000012000013000021000012000311000332000212";
	feverChains[10][0][3] = "12000012000023000023000023000131000113000332000213003322";
	feverChains[10][0][4] = "21000031000023000113000312000331001121001323022211";
	feverChains[10][0][5] = "21000031000023000113020312030331031121031323322211";
	feverChains[10][0][6] = "10001012002323012231011322132321313133332223";
	feverChains[10][0][7] = "2000003032302012312011311333232121212313123332233";
	feverChains[10][0][8] = "300000100000300000330000111301322312111231232131231222313131313311";
	feverChains[10][0][9] = "13000312200133200123100332120312211221323123122231313231133";
	feverChains[10][0][10] = "300000200000110003120002220001313231331233113321223231112112231322233111";
	feverChains[10][0][11] = "300000112000221100112123321232332132221223131232313313121233122111";
	feverChains[10][0][12] = "30012032011232132321122212333223122111331323222312111211232133322";
	// ------Colors: 4
	feverChains[10][1][0] = "31000031000023000022000011000123";
	feverChains[10][1][1] = "13000024000024000024000012000311000334";
	feverChains[10][1][2] = "4000002000002000041000021000023000041000014000011000334000314";
	feverChains[10][1][3] = "12000012000024000024000021000134000112000333000414004422";
	feverChains[10][1][4] = "21000031000023000143000342000334001124001323022211";
	feverChains[10][1][5] = "21000031000023000143020342040334041124041323422211";
	feverChains[10][1][6] = "42001043002323012234011322042324313113332223";
	feverChains[10][1][7] = "4032423012413011411333243141213313124332244";
	feverChains[10][1][8] = "400000100000400000440000111302422314111231242131243444431312431122";
	feverChains[10][1][9] = "13000314400133400123100332120342211214324413422131314131144";
	feverChains[10][1][10] = "200000110003140004220001321231441133433221341231414424131344133222";
	feverChains[10][1][11] = "33000011034014443331241421331122322441231421313314121244122111";
	feverChains[10][1][12] = "3030002032111432422324432412331443414311333312111321444113231213311";
	// ------Colors: 5
	feverChains[10][2][0] = "31000031000023000022000011000123";
	feverChains[10][2][1] = "13000024000024000024000012000311000334";
	feverChains[10][2][2] = "4000002000002000041000021000023000051000015000011000335000315";
	feverChains[10][2][3] = "12000012000024000024000021000134000112000333000514005522";
	feverChains[10][2][4] = "21000051000025000145000342000334001124001325022211";
	feverChains[10][2][5] = "25000035000023000143020342050334051124051323522255";
	feverChains[10][2][6] = "42001043002353012234011355042354515113552223";
	feverChains[10][2][7] = "4032523012513011511333253141213515124552244";
	feverChains[10][2][8] = "400000100000400000440000111302455314111531245131243444435352435522";
	feverChains[10][2][9] = "15000314400155400125100332150342211254354453455531314531144";
	feverChains[10][2][10] = "200000110003150004220001321251551155533221341251454424535344533222";
	feverChains[10][2][11] = "33000011054014443331241451551155522441231451353314525244522111";
	feverChains[10][2][12] = "5030002032111432422324452412551445414311555312111325444553231253311";
	// Type: Key & Stairwich Mix (11)
	// ------Colors: 3
	feverChains[11][0][0] = "21000032200013300011320";
	feverChains[11][0][1] = "3000032300013300032200013300011320";
	feverChains[11][0][2] = "200020100021300012200011200033110032120";
	feverChains[11][0][3] = "2112031321033232011232013232";
	feverChains[11][0][4] = "20001231023232122323113232323112";
	feverChains[11][0][5] = "1000002320002230011321012322033231032311322133";
	feverChains[11][0][6] = "3020013210311212323321321231213322321132";
	feverChains[11][0][7] = "2000003002102011223312111331333212122221332113113";
	feverChains[11][0][8] = "10000023001122003113122323311332122221233112113321221";
	feverChains[11][0][9] = "120000332000221100332100111330322211331333221211112333223221";
	feverChains[11][0][10] = "32000023300123110332312313221211333232122321131232311232133";
	feverChains[11][0][11] = "10000020003011002312133122222311111222323331312122112131321311312133";
	feverChains[11][0][12] = "100000300000232100232131321311232133211312333133221311212231123322211232";
	// ------Colors: 4
	feverChains[11][1][0] = "21000032200013300011320";
	feverChains[11][1][1] = "3000042400014400032200013300011320";
	feverChains[11][1][2] = "400040100041300014200011200033110032120";
	feverChains[11][1][3] = "4112031231033423011423013423";
	feverChains[11][1][4] = "10001141034234133223114434434234";
	feverChains[11][1][5] = "1000002340002240011331012344033421034211044322";
	feverChains[11][1][6] = "1000004000014231011432224223213243134422213342";
	feverChains[11][1][7] = "1000004002041012443311224334333114211442441113224";
	feverChains[11][1][8] = "10000024004122013114122424411443122113233332443114224";
	feverChains[11][1][9] = "20000430000332000221100312100444220311133334222224133441222223113";
	feverChains[11][1][10] = "4000132200442110334214313441411333332144221131332311444133";
	feverChains[11][1][11] = "10002340312440123311124341133223213444412322223343112433444344";
	feverChains[11][1][12] = "12103011433432344322421433442342321133321344314434143322311432";
	// ------Colors: 5
	feverChains[11][2][0] = "21000032200013300011320";
	feverChains[11][2][1] = "3000042400014400032200013300011320";
	feverChains[11][2][2] = "400040500045300054200055200033110032120";
	feverChains[11][2][3] = "4112031521033452011452013452";
	feverChains[11][2][4] = "10001151054235155223114435454235";
	feverChains[11][2][5] = "1000002540002240011551012544033451034511044355";
	feverChains[11][2][6] = "1000004000014251011453224225215245154433215543";
	feverChains[11][2][7] = "1000005002041012443511224554333334211442551335225";
	feverChains[11][2][8] = "10000054005155013114122454411443122113233332553114225";
	feverChains[11][2][9] = "20000450000552000221100512100444550311133334555554133441555553113";
	feverChains[11][2][10] = "4000152200442110554214513441411333332544225531332311444533";
	feverChains[11][2][11] = "10002540352440525511524541533223213444412522225543112433444544";
	feverChains[11][2][12] = "12105011455432544322421433442352521133521355514435143322511432";
}

std::string getFeverChain(int type, int colors, int chain, int offset)
{
	// Safe guard
	if (colors > 5 || colors < 3)
		colors = 4;
	if (chain > 15 || chain < 3)
		chain = 15;
	if (type > 11)
		type = 11;

	// Rotate colors
	const std::string fc = feverChains[type][colors - 3][chain - 3];
	std::string out;
	for (size_t i = 0; i < fc.size(); i++) {
		std::string str = fc.substr(i, 1);
		if (int n = toInt(str); n != 0) {
			n += offset;
			n %= colors;
			n += 1;
			out += toString(n);
		} else
			out += "0";
	}

	return out;
}

int getVoicePattern(int chain, int predicted, bool fever)
{
	--chain;
	--predicted;

	if (fever) {
		if (chain < 0 || chain > 29 || predicted > 29) {
			return 0;
		}
		if (chain > predicted) {
			return 0;
		}
		int offs = 0;
		const std::string type = voicePattern[predicted].substr(static_cast<size_t>(chain) * 2, 1);
		const int num = toInt(voicePattern[predicted].substr(static_cast<size_t>(chain) * 2 + 1, 1)) - 1;
		if (type == "c") {
			offs = 0;
		}
		if (type == "e") {
			offs = 5;
		}
		return offs + num;
	}

	chain = min(chain, 6);
	return voicePatternClassic[chain];
}

}
